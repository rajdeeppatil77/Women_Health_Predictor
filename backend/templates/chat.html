{% extends "base.html" %}

{% block content %}
<div class="glass-container" style="max-width: 600px;">
    <h2>Health Assistant Chatbot</h2>
    <div class="chat-box" id="chatBox">
        <div class="message bot-msg">Namaste! I am your health assistant. Ask me about symptoms, diet, or health issues.
        </div>
    </div>
    <div style="display: flex; gap: 1rem;">
        <input type="text" id="userInput" placeholder="Type your question here..."
            onkeypress="if(event.key === 'Enter') sendMessage()">
        <button class="btn" onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    async function sendMessage() {
        const input = document.getElementById('userInput');
        const message = input.value.trim();
        if (!message) return;

        const chatBox = document.getElementById('chatBox');

        // User Message
        chatBox.innerHTML += `<div class="message user-msg">${message}</div>`;
        input.value = '';
        chatBox.scrollTop = chatBox.scrollHeight;

        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message })
            });
            const data = await response.json();

            // Bot Message
            chatBox.innerHTML += `<div class="message bot-msg">${data.response}</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        } catch (error) {
            chatBox.innerHTML += `<div class="message bot-msg" style="color: red;">Error connecting to server.</div>`;
        }
    }
</script>
{% endblock %}